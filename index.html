<html>

<head>
    <title>Notifications test</title>
</head>

<body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.1/jquery.min.js"></script>
    <script type="text/javascript">
    function registerServiceWorker() {

        var path = location.pathname + 'sw.js';

        if (!('serviceWorker' in navigator)) {
            alert('Not supported: serviceWorker');
            return;
        }

        navigator.serviceWorker
            .register(path)
            .then(
                function() {
                    console.log("Service Worker Registered");
                },
                function(err) {
                    console.error("Service worker err:", err);
                });

        Notification.requestPermission(function(result) {
            if (result === 'granted') {
                navigator.serviceWorker.ready.then(function(registration) {
                    _registration = registration;
                });
            }

        });

    }

    function swNotify() {
        var text = $('#message').val() || '(no message)';
        var title = $('#title').val() || '(no title)';
        var delay = $('#delay').val();
        if (delay) delay = parseInt(delay) * 1000;
        var ttl = $('#seconds').val();
        var timeout;
        if (ttl) {
            timeout = ttl * 1000;
        }



        if (_registration) {
            setTimeout(function() {
                navigator.serviceWorker.ready.then(function(registration) {
                    registration.showNotification(title, {
                        body: text,
                        vibrate: [200, 100, 200, 100, 200, 100, 200],
                        tag: 'vibration-sample',
                        timeout: timeout,
                        data: {
                            field1: 'First field',
                            field2: 'Second field',
                            closeOnClick: true,
                            anArray: [1, 2, 3]
                        }
                    })
                });
            }, delay || 0);

        }
    }

    function onNotifyClick() {
        alert('outter notification clicked!');
    }



    $(document).ready(function() {
        var notificationSupported = "Notification" in window;
        var webkitNotificationsSupported = "webkitNotifications" in navigator;
        var content =
            "window.Notification is supported: " + notificationSupported + "<br>navigator.webkitNotifications is supported: " + webkitNotificationsSupported;
        document.getElementById('support').innerHTML = content;

        // register sw
        registerServiceWorker();

    });
    </script>
    <div id="support"></div>
    <input id="title" type="text" placeholder="Title..." />
    <input id="message" type="text" placeholder="Message..." />
    <input id="seconds" type="number" placeholder="Seconds to live..." />
    <input id="delay" type="number" placeholder="Delay seconds..." />
    <button onclick="swNotify()">Delay SW</button>
</body>

</html>
